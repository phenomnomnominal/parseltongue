<div class="centered row">
    <h1>Parseltongue:</h1>
</div>

<div class="centered row">
    <h2>Let's try some regex:</h2>
    <pre>
        <code>
<span class="identifier">sssSpell</span> <~ <span class="literal">'Expecto Patronum'</span>

<span class="function">sssMagic</span> [<span class="argument">sssSpell</span>, <span class="argument">sssIntensity</span>]
    <span class="identifier">sssIntense</span> <~ <span class="literal">''</span>
    <span class="keyword">sssss</span> <span class="identifier">sssI</span> <~ <span class="literal">0</span> ~> <span class="argument">sssIntensity</span>
        <span class="identifier">sssIntense</span> <~ <span class="identifier">sssIntense</span> + <span class="literal">'!'</span>

    <~ <span class="argument">sssSpell</span> + <span class="identifier">sssIntense</span>

<span class="identifier">sssResult</span>
<span class="keyword">sssss</span> <span class="identifier">sssI</span> <~ <span class="literal">0</span> ~> <span class="literal">10</span>
    <span class="identifier">sssResult</span> <~ <span class="function">sssMagic</span> <~ [<span class="argument">sssSpell</span>, <span class="argument">sssI</span>]
        </code>
    </pre>
</div>

<div class="centered row">
    <button id="run3" class="massive inverted blue ui button">
        Run!
    </button>
    <button id="next" class="massive inverted green ui button">
        Next!
    </button>
</div>

<script>
    let spell = `
sssSpell <~ 'Expecto Patronum'

sssMagic [sssSpell, sssIntensity]
    sssIntense <~ ''
    sssss sssI <~ 0 ~> sssIntensity
        sssIntense <~ sssIntense + '!'

    <~ sssSpell + sssIntense

sssResult
sssss sssI <~ 0 ~> 10
    sssResult <~ sssMagic <~ [sssSpell, sssI]
    `;

    $('#run3').click(run3);

    function run3 () {
        debugger;
        let lines = spell.split(/\n/);
        console.log(lines);
        let js = lines.map(line => {
            let [parsed] = [
                findVariableAssignment,
                findWhileLoop,
                findFunctionDeclaration
            ].map(parser => parser(line)).filter(Boolean);
            return parsed;
        }).join('\n');
        console.log(js);
    }

    function findVariableAssignment (line) {
        let result = line.match(/^( {4})*sss([a-zA-Z]*) <~ (.*)/);

        if (result) {
            let [, indents, name, value] = result;
            return `var ${lowerCaseFirst(name)} = ${value};`;
        }
        return null;
    }

    function findWhileLoop (line) {
        let whileLoop = /^( {4})*sssss sss([a-zA-z]+) <~ (.*) ~> (.*)/;
        let result = line.match(whileLoop);

        if (result) {
            let [, indents, indexer, from, to] = result;
            let i = lowerCaseFirst(indexer);
            return `for (var ${i} = ${from}; i < ${to}; i += 1) {`;
        }
        return null;
    }

    function findFunctionDeclaration (line) {
        let fdr = /^( {4})*sss([a-zA-z]+) \[(?:sss([a-zA-Z]+), )*sss([a-zA-z]+)\]/;
        let result = line.match(fdr);

        if (result) {
            let [, indents, name, ...parameters] = result;
            let params = parameters.join(', ');
            return `function ${lowerCaseFirst(name)} (${params}) {`;
        }
        return null;
    }

    function lowerCaseFirst (str) {
        return `${str[0].toLowerCase()}${str.substr(1)}`;
    }
</script>
